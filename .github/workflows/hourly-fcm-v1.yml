name: fcm-token-test

on:
  schedule:
    - cron: "*/3 * * * *"   # каждые 3 минуты
  workflow_dispatch: {}      # можно запустить вручную

jobs:
  send:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/setup-node@v4
        with:
          node-version: 20

      - run: npm i google-auth-library node-fetch@2

      - name: Send silent push directly to token
        env:
          GOOGLE_APPLICATION_CREDENTIALS_JSON: ${{ secrets.GOOGLE_APPLICATION_CREDENTIALS_JSON }}
          FIREBASE_PROJECT_ID: ${{ secrets.FIREBASE_PROJECT_ID }}
          TARGET_FCM_TOKEN: "cqyZqDMuCEEhhahLWG7tdI:APA91bEn7DE5fUiVwA17R19H7GoD7ekET6_2uFFI2_6L2y8yQYTSZmQcQp0cVcDssXfMD130fqWuuSnZqIxkFO9Jicf-IJcmUyOv_A9fRVbWwJ59sL5vADo"
        run: |
          node - <<'NODE'
          const {GoogleAuth} = require('google-auth-library');
          const fetch = require('node-fetch');

          const creds = JSON.parse(process.env.GOOGLE_APPLICATION_CREDENTIALS_JSON);
          const projectId = process.env.FIREBASE_PROJECT_ID;
          const targetToken = process.env.TARGET_FCM_TOKEN;

          (async () => {
            const auth  = new GoogleAuth({
              credentials: creds,
              scopes: ['https://www.googleapis.com/auth/firebase.messaging']
            });
            const client = await auth.getClient();
            const token  = await client.getAccessToken();

            const
